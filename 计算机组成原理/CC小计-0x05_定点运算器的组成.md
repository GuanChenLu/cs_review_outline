# 定点运算器的组成

> 前面学习了最基本的四种算术运算，现在让我们将他们和逻辑运算组合起来，使用定点运算器来实现吧

## 逻辑运算

不展开，默认都会



## 多功能算数/逻辑运算单元

前面我们学习了一位全加器，它接受来自低位的一个进位，对输入的 `A, B` 变量经行运算，产生结果并且产生向高位的进位输出

基于全加器，我们希望扩充它的功能，不直接将输入的 `A, B` 和进位数 `C` 直接相加，而是将 `Ai, Bi`先组合成由控制参数 `s0 ~ s3` 控制的组合参数 `Xi, Yi`，然后再将 `Xi, Yi` 和 `C` 做运算

![](https://gitee.com/chenlu-guan/t-image/raw/master/026ba8f999bf1164926cac40aabbfe0.jpg)

图中使用 `n + i` 来代替原来一位全加器中的`i`，`i` 表示集成在一片电路上的`ALU`的二进制位数，对于四位一片的 `ALU`，`i = 0, 1, 2, 3`

`n` 代表若干片 `ALU` 组成更大字长的运算器时每片电路的进位输入，如果4片组成16位字长的运算器时，`n = 0, 4, 8, 12`

![](https://gitee.com/chenlu-guan/t-image/raw/master/085c269431d8885b44b2577b264d376.jpg)



### ALU 逻辑结构的简单表达式

如上图所示， `s0, s1` 控制 `X`，`s2, s3`控制 `Y`

这里补探究函数发生器的内部实现，直接给出真值表

![](https://gitee.com/chenlu-guan/t-image/raw/master/9e621d3cf4392e785834be83e6fa3d2.jpg)

根据真值表，我们可以直接写出 `X` 和 `Y` 的逻辑表达式

![](https://gitee.com/chenlu-guan/t-image/raw/master/f224c050ab965cb536cee6c4d1f01d3.jpg)

将 `X` 和 `Y` 作为入参带入到全加器的公式中，可以得到的表达式如下

![](https://gitee.com/chenlu-guan/t-image/raw/master/44c8f85967a310493661a722a79bbfc.jpg)

我们重点来关注进位 `Cn+i+1` 和 `Cn+i` 

假设我们采用四位的`ALU`，使用迭代，可以直接得到 `Cn+1 ~ Cn+4` 的表达式

![](https://gitee.com/chenlu-guan/t-image/raw/master/c95d083f3b8457a58612ec8cdb2dda2.jpg)

可以看到，一旦确定了最低为的进位和输入，高位上的进位标记就会自然地得到，我们将这个公式成为`先行进位公式`

> 换就话说，来自最低为的进位可以直接传送到最高位上去，这样大大提高了受`进位延迟`的全加器的运行速度

要实现这种`先行进位`的功能，还需要配备一个 `先行进位发生器(CLA)`

![](https://gitee.com/chenlu-guan/t-image/raw/master/4f7f26b76dd0511bacc5cf84d20e4e3.jpg)

对于一个 `CLA` 来说，有三个输出位，我们将`G`称为进位发生输出，`P`称为进位传递输出，在电路中多加这两个输出的原因是便于实现多篇 `ALU` 之间的先行进位，下面会讲到



## 算数逻辑运算的实现

我们来看看能够实现算数逻辑运算的 `74181ALU` 的逻辑电路图

![](https://gitee.com/chenlu-guan/t-image/raw/master/87f934141558490fd31bcbe39a096a7.jpg)

就是在函数发生器之上加着 `CLA`

除了 `s0 ~ s3`四个控制端之外，还有 `M` 来控制 `ALU` 进行逻辑运算还是算术运算

- 当 `M = 0` 时，对进位信号没有影响，实行算数运算
- 当 `M == 1`时，封锁进位输出，实现逻辑运算

下面以一张表来说明 `74181LU` 的运算功能表

<img src="https://gitee.com/chenlu-guan/t-image/raw/master/c7459dcf949031156db2b6fd838a7c7.jpg" style="zoom:50%;" />

它有两种工作方式，对于正逻辑操作数来说，算数运算称为高电平操作，逻辑运算称为正逻辑操作(废话)，这种情况下 `高电平为 '1'`；对于负操作数来说恰好相反

注意，上述的算术运算是由补码表示法来表示的，还有，其中数的反码是由内部产生的，而结果会输出 `A减B减1`，因此在做减法时必须在最末位产生一个强迫进位(+1)



> 可以看到，`ALU` 不仅是全加器的升级版，还可以进行多种逻辑运算，大大减少了额外的设计



## 两级先行进位 `ALU`

在前面埋下伏笔说，`74181ALU` 设置了 `P, G` 两个本组先行进位输出端，可以实现多片 `ALU` 之间的先行进位

如果将 `4` 片 `74181` 的`P, G` 输入到先行进位部件中，又可以实现第二级的先行进位(就好比是将 `P, G` 当作是原来决心运算的 `X, Y`)

<img src="https://gitee.com/chenlu-guan/t-image/raw/master/af988794ea94b080540baa8f8fb8b25.jpg" style="zoom:67%;" />

根据上述表达式，我们使用 `TTL` 器件来实现，这个期间也会输出 `P*` 和 `G*`

<img src="https://gitee.com/chenlu-guan/t-image/raw/master/e9fcc1f4a726c915de9d4b02bef0141.jpg" style="zoom:67%;" />

很显然，对于一个 16 位来说， `CLA` 部件构成了第二级先行进位部件，实现四个小组之间(位片)之间的先行进位，从而使全字长 `ALU` 运算时间大大缩短



## 内部总线

内部总线是指 `CPU` 内部件的连线，外部总线是指系统总线

这一部分在书上没有详细说明，下面只展示使用三态门组成的双向数据总线

<img src="https://gitee.com/chenlu-guan/t-image/raw/master/e582539ba28446d9c9fc9f88122bf9d.jpg" style="zoom:50%;" />



## 定点运算器的基本结构

运算器包括 `ALU`、阵列乘除器、寄存器、多路开关、三态缓冲器、数据总线等逻辑部件组成

运算器的设计，主要是围绕 `ALU` 和寄存器同数据总线之间如何传送操作数和运算结果而进行的

在决定方案时，需要考虑数据传送的方便性和操作速度

按照总线的条数分类，计算机的运算器大概有以下三种

<img src="https://gitee.com/chenlu-guan/t-image/raw/master/097d129bd9add4dcc27e12317c89dd6.jpg" style="zoom:67%;" />



- 单总线结构的运算器

  对于这种结构来说，在同一时间内，只有一个操作数放在总线上
  
  为了将两个操作输入 `ALU`，需要两次来做，所以需要两个缓冲器
  
  但是，如果数据是从存储器中来的，运算结果又送回存储器，那么限制数据传送速度的主要因素是存储器的访问时间，只有在对全都是 `CPU寄存器` 中的两个数据进行操作的时候，单总线结构才会造成一定的损失
  
- 双总线结构的运算器

  在这种结构中，两个操作数同时加到 `ALU` 中，只需要一次操作
  
  专用寄存器分为两组，分别于一条总线交换数据，使得通用寄存器中的数据能够进入到任意组专用寄存器中，从而使数据传输更加灵活
  
  在执行完操作之后，两条总线都被输入端占据，因此必须在 `ALU` 输出端和总线之间追加一个缓冲器
  
  如果在`ALU` 两个输入端增加寄存器也能得到同样的效果
  
- 三总线结构的运算器
  
  `ALU`的两个输入端分别由两条总线供给，输出和第三条总线相连，这样算术操作既可以在一步控制之内完成
  
  由于 `ALU` 有延迟，所以打入输出结果的[选通脉冲](https://baike.baidu.com/item/%E9%80%89%E9%80%9A%E8%84%89%E5%86%B2/2288543?fr=aladdin)必须考虑这个延迟
  
  另外还设置了一个 `总线旁听器`，如果一个操作数不需要修改，就可以通过 `总线旁听器`把数据输出，如果需要修改就借助于 `ALU`
  
  这种结构的操作速度快
  
  
  
  
  
  <br/><br/>
  
  完
  
  <br/><br/><br/><br/>
  
  
  
  ---
  
  计算机组成原理小计持续更新，欢迎关注 :smile:
  
  

