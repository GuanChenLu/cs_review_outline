# DRAM 的存储方式及存储优化

## DRAM 存储器的工作原理

> 在上节中讲过，`SRAM` 就是一个触发器，它具有两个稳定的状态，但是其中布线较为复杂，而 `DRAM` 简化了存储器的结构，从而使 `DRAM` 的存储密度很高，因此通常选择 `DRAM` 作为计算机的存储器

如图所示， `DRAM` 的存储元是由电容组成的

![](https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329201059.png)

但需要写入数据时，输入缓冲器打开，输出缓冲器关闭

输入数据 `Dn = 1` 被加在存储元的位线上

行选线为高，打开 `MOS` 管，输入数据被保存在电容上



下图所示为从存储元读出的过程

![](https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329201539.png)

与输入数据时相反，读出数据时输入缓冲器和刷新缓冲器均关闭，输出缓冲器打开(输入/输出缓冲器是互锁的)

行选线为高，打开 `MOS` 管，将电容中存储的信息送到位线上



读出的过程破坏了电容上的存储信息，所以要把信息重新写入，就是所说的 `刷新`

读出数据后，输入缓冲器保持关闭，刷新缓冲器打开，输出的数据又经过刷新缓冲器送回到位线上，再经过 `MOS` 管重写到电容上



从上面的工作原理中可以看出，`DRAM` 所需要的存储元件更少，所以存储密度更高，但是其附属电路比较复杂，访问时需要额外的电路和操作支持



## 芯片的逻辑结构

下图展示了 `DRAM` 芯片的外部引脚图

<img src="https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329202546.png" style="zoom:25%;" />

下图展示的是该芯片的内部逻辑图

![](https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329202723.png)

重点来看一下逻辑结构图

其中，`CAS` 和`RAS` 分别为列地址锁存器和行地址锁存器

由于`DRAM`的容量往往较大，内部往往有较多的地址线，因此，为了减少引脚的数量，将`行地址和列地址分时传送` 

假设存储的容量(地址范围)为`1M`，总共需要 `20` 位地址线，则先传送地址码 `A0 ~ A9` 通过 `RAS` 打入 `行地址锁存器`，再传送地址码 `A10 ~ A19` 通过 `CAS` 打入 `列地址锁存器`



## DRAM 的读写时序

<img src="https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329203420.png"  />

```shell
打入行选信号 -> 打入列选信号 -> 地址译码 -> 读写命令有效 -> 输出
```



![](https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329203639.png)

写周期输入地址的操作和读周期相似，区别就是在读写命令生效的期间，数据线上必须送入欲写入的数据



从上面的两个图中可以看出，每个读/写周期是从 `RAS` 下降沿开始，到下一个 `RAS` 下降沿为止的时间间隔，这也就是连续两个读/写周期的时间间隔，通常为了控制方便，读写周期控制相等



## DRAM 中的刷新操作

前面我们提到过，进行读出操作时必须要刷新，而未读写的存储元也要定期刷新，否则会发生`漏电`

现代的 `DRAM` 会在因此 `读操作` 之后主动地刷新选中**行所有的存储单元**，但这种操作出现的时间是不固定的，因此必须进行周期性的刷新

需要说明的是，使用 `DRAM` 做系统主存的相同通常需要通过 `存储控制器` 和 `DRAM 控制器` 产生对 `DRAM`  的访问和刷新时许的控制与地址信号



周期性刷新策略一般分为

- 集中式
- 分散式
- 异步刷新

看图就懂

![](https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329205139.png)



![](https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329205207.png)

<img src="https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329205441.png"  />





## `SRAM` 和 `DRAM` 的比较

![](https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329205533.png)



## 提高 `DRAM` 的访问速度

![](https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329211300.png)



## 高级的 `DRAM` 结构

### 同步 `DRAM(SDRAM)`

![](https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329211651.png)



- `SDRAM`自带时钟控制信号，与系统总线频率同步，它与`CPU`的数据交换同步于外部的`系统时钟信号`，并且以`CPU/存储器总线的最高速度`运行，而`不需要插入等待状态`
- `SDRAM`内含交错的`存储阵列`，当`CPU`从一个存储阵列访问数据的同时，另一个`已准备好读写数据`，通过两个存储阵列的`紧密切换`，读取效率得到成倍提高，较新的SDRAM的存储速度高达几个纳秒 



![](https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329215833.png)



对比 `SDRAM` 和 `DRAM` 

![](https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329215943.png)







### 双倍数据率 `SDRAM`(DDR SDRAM)

侠义的 `SRAM` 指的是单倍数据率的 `SDR DRAM`，只能在时钟上升沿传输数据

而 `DDR SDRAM` 最大的特点是在时钟的上升沿和下降沿都能传输数据



双倍数据率结构本质上是一个 `2n` 预取结构

**内部的总线宽度**是外部总线宽度的两倍

从存储矩阵到 `I/O` 缓冲区每个时钟周期传送 `2n` 比特数据

从 `I/O` 缓冲区到数据总线则在时钟触发器的上升，下降沿都能传送数据

![](https://pic22go.oss-cn-beijing.aliyuncs.com/md/580885943728513531.jpg)



后面相继出现的 `DDR2、DDR3` 等技术的主要改进在于 `提升存储矩阵输出的数据率`，利于 `DDR2` 采用 `4n` 预取结构，将数据总线的时钟频率提升至内部存储频率的 `2倍`，从而使外部总线的数据率比 `DDR SDRAM` 提升一倍，类似的，`DDR3` 采用 `8n` 预取结构

`DDR4` 仍然采用 `8n` 预取，但是允许使用两个或四个存储体组，对于每个存储体组都有独立的 `激活、读取、写入、刷新`操作，因此如果是设计了两个独立的存储体组，就相当于将农村的预取值提升到了`16n`，设计四块就相当于将预取值提高到了 `32n`





### 缓存 `DRAM`

在`DRAM`芯片上集成了一个`SRAM`实现的小容量高速缓冲存储器，从而使`DRAM`芯片的访问速度得到显著提升

![](https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329223812.png)

优点

1. 突发操作速度高

2. 在SRAM**读出期间**可同时对DRAM阵列进行刷新

3. 芯片内的数据输出路径与输入路径是分开的，

   允许在写操作的**同时启动同一行的读操作**



#### `CDRAM` 的存储模块

8个芯片共用片选信号 `Sel`，行选信号 `RAS`，刷新信号 `Ref`和地址输入信号 `A0 ~ A10`

每两片 `1M * 4` 位的 `CDRAM` 芯片的 `列选信号` `CAS` 结合在一起，形成一个 `1M * 8` 位的片组，四个片组组成一个 `1M * 32` 位的存储模块



数据总线的宽度为 `32位`，为了使 `CPU` 与存储器交换数据方便，每次访存时可以由 `CPU` **实现多种数据长度的存取(一个字节、自、双字)**

为了实现这种效果，`CPU` 送出的地址线中最低两位 `A1`和`A0` 并不输出，而是送出`连续四个字节组成的32位字的字地址（最低两位固定为00），外加 4 个*字节允许信号*(横竖看着都像是字，不是字节)`

比如说，当进行 `32位存取时`，`BE3 ~ BE0` 都有效，而当存取低有效半字(与数据线 `D0 ~ D15` 对应时)，`BE3 ~ BE0` 为 `1100`

![](https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329224236.png)



![](https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220330162959.png)

上图给出了该 `CDRAM` 内存模块的低位地址排列关系，该模块按小端模式安排地址，四个片组的列选通信号 `CAS3 ~ CAS0` 分别于 `CPU` 送出的四个字节允许信号 `BE3 ~ BE0` 相对应



当某模块被选中并且完成 `32位存取` 时，此模块的 8 个 `CDRAM` 芯片同时工作，`8 个 * 4位` IO 端口同时与 `32位数据总线`交换数据，完成一次 `32位` 的存取

这 `32` 位存储字模块内地址对应着存储地址中的 `A21 ~ A2`，这二十位地址分为 `11` 位行地址和 `9` 位列地址



系统存储地址的最高两位 `A23\A22` 作为**模块选择地址**，译码输出可以驱动 4 个这样的 `4MB` 模块的 `Sel` 信号，就相当于是 `片选器`



上述的存储模块具有高速的突发存取能力，如果需要连续访问的数据块的高 13 位地址相同(模块选择地址和行地址相同)，列地址被缓存在 `SRAM` 中，那么只是存取第一个存储字需要一个完整的周期，后续只需要从 `SRAM` 中读出，典型时序就是 `6-2-2-2`



## `DRAM`主存读/写的正确性校验   

为保证读写操作的正确性与可靠性，除了正常的数据位宽度，还增加了`附加位`，用于读/写操作正确性校验，增加的附加位也要同数据位`一起写入DRAM中保存`

![](https://pic22go.oss-cn-beijing.aliyuncs.com/md/20220329223445.png)





<br/><br/>

完

<br/><br/><br/><br/>



---

计算机组成原理小计持续更新，欢迎关注 :smile:






